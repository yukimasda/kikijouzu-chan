<script>
  async function getChatGPTResponse(inputText) {
    const apiKey = "YOUR_API_KEY"; // ここに自分のAPIキーを入力
    const url = "https://api.openai.com/v1/completions";
    const response = await fetch(url, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${apiKey}`,
      },
      body: JSON.stringify({
        model: "gpt-3.5-turbo",
        messages: [
          {
            role: "system",
            content: "あなたは優しく愚痴を聞いてくれるAIです。"
          },
          {
            role: "user",
            content: inputText
          },
        ],
      }),
    });

    const data = await response.json();
    return data.choices[0].message.content.trim();
  }

  recognition.onresult = async (event) => {
    const transcript = event.results[0][0].transcript;
    log.innerHTML += `<div class="user">あなた：${transcript}</div>`;

    // ChatGPTに愚痴を送って返答をもらう
    const aiText = await getChatGPTResponse(transcript);
    log.innerHTML += `<div class="ai">聞き上手ちゃん：${aiText}</div>`;
    speak(aiText);
  };
</script>
